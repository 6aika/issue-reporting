{% extends "base.html" %}
{% load staticfiles %}
{% block head %}

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.min.js" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.js" charset="utf-8"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.css"/>

{% endblock %}
{% block content %}
{%include "statistics_menu.html" with charts_active="active"%}
<h1>Palvelukaaviot</h1>
<div id="serviceStatistics" style="margin-top: 20px"></div>
<h1>Virastokaaviot</h1>
<div id="agencyStatistics" style="margin-top:20px"></div>
<h1>Aikakaaviot</h1>
<div id="timeStatistics" style="margin-top: 20px; padding-right: 5px;"></div>

<script>



    $.getJSON("/api/v1/statistics/services/", function (data) {
        var services = ['x'];
        var total = ['total'];
        var closed = ['closed'];
        var fixing_time_in_hours = ['Fixing Time In Hours'];


        $.each(data, function (key, item) {
            services.push(item.service_name);
            total.push(item.total);
            closed.push(item.closed);
            fixing_time_in_hours.push(Math.floor(item.median_sec/86400))
        });
        c3.generate({
            bindto: '#serviceStatistics',
            data: {
                x: 'x',
                columns: [
                    services,
                    total,
                    closed
                ],
                type: 'bar',


            },


            axis: {

                x: {


                    type: 'category', // this needed to load string x value
                    tick: {
                rotate: 75,
                multiline: false
            },
            height: 130
                }
            }

        });
        c3.generate({

            bindto: '#timeStatistics',
            data: {
                x: 'x',
                columns: [
                    services,
                    fixing_time_in_hours
                ],
                type: 'bar',
                labels: true
            },
            axis: {


                x: {

                    type: 'category', // this needed to load string x value
                    tick: {
                rotate: 75,
                multiline: false
            },
            height: 130
                }
            }
        });
    });

    $.getJSON("/api/v1/statistics/agencies/", function (data) {
        var agencies = ['x'];
        var total = ['total'];
        var closed = ['closed'];
        $.each(data, function (key, item) {
            if (key > 9) return;
            agencies.push(item.agency_responsible);
            total.push(item.total);
            closed.push(item.closed);
        });
        c3.generate({
            bindto: '#agencyStatistics',
            padding: {

        right: 12,

    },
            data: {
                x: 'x',
                columns: [
                    agencies,
                    total,
                    closed
                ],
                type: 'bar',
            },
            zoom: {
                enabled: true,
                rescale: true
                },

            axis: {

                x: {
                 
                    type: 'category' ,// this needed to load string x value
                    tick: {
                        rotate:75,
                        multiline: false
            },
            height: 160
                }
            }
        });
    });

</script>


{% include 'footer.html' %}
{% endblock %}