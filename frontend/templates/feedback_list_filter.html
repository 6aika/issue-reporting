<div class="feedback_list_filters">
    <form role="form" id="feedback-filter" method="get" class="form-horizontal" enctype="multipart/form-data">
        <div class="row">
            <div class="col-sm-2 col-md-2">
                <label for="datepicker-start">Alku</label>
                    <div class="calendar form-group">
                      <div class='input-group date' id='datepicker-start'>
            						<span class="input-group-addon" style="cursor:pointer">
            							<span class="glyphicon glyphicon-calendar"></span>
            						</span>
                        <input type='text' class="form-control" name="start_date" value="{{queries.start_date}}"/>
                      </div>
                    </div>

                <label for="datepicker-end">Loppu</label>
                <div class="calendar form-group">
                  <div class='input-group date' id='datepicker-end'>
        						<span class="input-group-addon" style="cursor:pointer">
        							<span class="glyphicon glyphicon-calendar"></span>
        						</span>
                    <input type='text' class="form-control" name="end_date" value="{{queries.end_date}}"/>
                  </div>
                </div>
            </div>
        </div>

        <div class="col-sm-2 col-md-2">
            <div>
                <label for="status">Tila</label>
                <select class="form-control" name="status" id="status">
                    <option selected="selected" value="">Status</option>
                    <option value="open">Open</option>
                    <option value="closed">Closed</option>
                </select>
            </div>
            <div>
                <label for="order_by">Järjestä</label>
                <select class="form-control" name="order_by" id="order_by">
                    <option selected="selected" value="">Order by</option>
                    <option value="-requested_datetime">Creation datetime</option>
                    <option value="distance">Distance</option>
                    <option value="-vote_counter">Votes</option>
                </select>
            </div>
        </div>

<<<<<<< HEAD
            <div class="col-sm-5 col-md-5">
                <label for="search">Sanahaku</label>
                <input type="text" class="form-control" name="search" id="search" placeholder="Esim. polkupyörä, Annankatu, rakennusvirasto..."/>
=======
        <div class="col-sm-3 col-md-3">
            <label for="service_code">Aihealue</label>
            <select class="form-control" name="service_code" id="service_code">
                <option selected="selected" value="">Service name</option>
                {% for service in services %}
                <option value="{{service.service_code}}">{{ service.service_name }}</option>
                {% endfor %}
            </select>
        </div>
>>>>>>> 1b04a05c9710ca68a2e96584876d3a3a1dd5a244

        <div class="col-sm-5 col-md-5">
            <label for="description">Kuvaus</label>
            <input type="text" class="form-control" name="description" id="description" placeholder="Kuvaus"/>

<<<<<<< HEAD
            <div>
                <input type="text" name="lat" id="lat" style="display: none;"/>
                <input type="text" name="lon" id="lon" style="display: none;"/>
            <div>
        </div>
    </form>
</div>
=======
            <button class="btn btn-primary" type="submit" value="apply">
                Apply
            </button>
        </div>

        <div>
            <input type="text" name="lat" id="lat" style="display: none;"/>
            <input type="text" name="lon" id="lon" style="display: none;"/>
        </div>
    </div>
</form>
>>>>>>> 1b04a05c9710ca68a2e96584876d3a3a1dd5a244
<script type="text/javascript">

    var status = "{{queries.status}}";
    var order_by = "{{queries.order_by}}";
    var service_code = "{{queries.service_code}}";
    var search = "{{queries.search}}";

    $("#status").val(status);
    $("#order_by").val(order_by);
    $("#service_code").val(service_code);
    $("#search").val(search);

    function dateStrToIso(dateStr) {
        var dateParts = dateStr.split(".");
        date = new Date(dateParts[2], (dateParts[1] - 1), dateParts[0]);
        return date.toISOString();
    }

    $("#feedback-filter").submit(function (event) {
        event.preventDefault();

        if ($("#order_by").val() === 'distance') {
          if (navigator.geolocation) {
            console.log("getting geoloc");
            var that = this;
              navigator.geolocation.getCurrentPosition(function (position) {
                  $("#lat").val(position.coords.latitude);
                  $("#lon").val(position.coords.longitude);

                  that.submit();
              }, function() {alert("Ordering by distance is not allowed with disabled geolocation");});
          } else {
            alert("Geolocation is not supported by this browser");
          }
        } else {
            this.submit();
        }
    });
</script>
